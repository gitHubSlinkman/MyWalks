---
title: "Walks by Routes"
author: "by Craig W. Slinkman"
date: "May 14, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE )

```

```{r load libraries}
#
source( "functions/load_libraries_v003.R" )      # Load libraries ...
#
```


```{r load_functions}
#
source('~/R-Projects/Rsource/compute_dates_v004.R') # To compute dates 
#       
```

```{r get_dates}
#
dates <- compute_dates()                         # Compute dates used ...
date_current <-   dates$date_000_days_ago        # Get current date ...
date_partition <- dates$date_180_days_ago        # Get date 180 days ago ...
#
```


```{r get_all_walks}
#
file_path <- file.path( "data",             # Build path to file ...
                        "days_180.rds" ) 
#
load( file_path )                           # Load data_180 from rds file 
                                            # fays_180 ...
```


```{r summarise_walks_by_route}
#
walked_days <-                             # Keep only days with walks ...
    days_180 %>%      
        filter( walked == 1)


summary_by_route  <- 
    walked_days %>% 
        group_by( route ) %>% 
        summarise( walks = n(),
                   tl_miles  = round( sum( miles,  na.rm = TRUE ), 2 ),
                   tl_hours  = round( sum( hours,  na.rm = TRUE ), 2 ),
                   mn_miles  = round( mean( miles, na.rm = TRUE ), 2 ),
                   mn_hours  = round( mean( hours, na.rm = TRUE ), 2 ),
                   mn_mph    = round( mean( mph,   na.rm = TRUE ), 2 ),
                   tl_gain   = round( sum( gain,   na.rm = TRUE ), 0 ),
                   mn_gain   = round( mean( gain,  na.rm = TRUE ), 0 ),
                   tl_kcal   = round( sum( kcal,   na.rm = TRUE ), 0 ),
                   mn_kcal   = round( mean( kcal,  na.rm = TRUE ), 0 ),
                   tl_ksteps = round( sum( ksteps, na.rm = TRUE ), 3 ),
                   mn_ksteps = round( mean( ksteps,na.rm = TRUE),  3 )) %>%
    select( route,
           walks,
           tl_miles,
           tl_ksteps,
           tl_gain,
           tl_hours,
           tl_kcal,
           mn_miles,
           mn_ksteps,
           mn_hours,
           mn_gain,
           mn_mph,
           mn_kcal )
#
summary_line <- 
     walked_days %>% 
        summarise( route = "All routes",
                   walks = n(),
                   tl_miles  = round( sum( miles,  na.rm = TRUE ), 2 ),
                   tl_hours  = round( sum( hours,  na.rm = TRUE ), 2 ),
                   mn_miles  = round( mean( miles, na.rm = TRUE ), 2 ),
                   mn_hours  = round( mean( hours, na.rm = TRUE ), 2 ),
                   mn_mph    = round( mean( mph,   na.rm = TRUE ), 2 ),
                   tl_gain   = round( sum( gain,   na.rm = TRUE ), 0 ),
                   mn_gain   = round( mean( gain,  na.rm = TRUE ), 0 ),
                   tl_kcal   = round( sum( kcal,   na.rm = TRUE ), 0 ),
                   mn_kcal   = round( mean( kcal,  na.rm = TRUE ), 0 ),
                   tl_ksteps = round( sum( ksteps, na.rm = TRUE ), 3 ),
                   mn_ksteps = round( mean( ksteps, na.rm = TRUE), 3 )) %>%
    select( route,
           walks,
           tl_miles,
           tl_ksteps,
           tl_gain,
           tl_hours,
           tl_kcal,
           mn_miles,
           mn_ksteps,
           mn_hours,
           mn_gain,
           mn_mph,
           mn_kcal )

summary_by_route <- bind_rows( summary_by_route,
                               summary_line )
last_row <- dim( summary_by_route )[1]
                  
```  

### Summary of walks by route

```{r display_summary_by_route}
#
decimal_0 <- c( 5, 7, 13 )
decimal_2 <- c( 3:4, 8, 10, 12 )
decimal_3 <- c( 4, 9 )
#
summary_by_route %>% 
    regulartable() %>% 
    width( j = 1, 15.0 ) %>% 
    colformat_num( j = decimal_0,
                   big.mark = ",",
                   digits   = 0,
                   na_str = "" ) %>% 
    colformat_num( j = decimal_2,
                   big.mark = ",",
                   digits   = 2,
                   na_str = "" ) %>% 
    colformat_num( j = decimal_3,
                   big.mark = ",",
                   digits   = 3,
                   na_str = "" ) %>% 
    set_header_labels( "route"     = "Route",
                       "walks"     = "Walks", 
                       "tl_miles"  = "Total  \nmiles",
                       "tl_hours"  = "Total\nhours",
                       "mn_miles"  = "Mean\nmiles",
                       "mn_hours"  = "Mean\nhours",
                       "mn_mph"    = "Mean\nMPH",
                       "tl_gain"   = "Total\ngain ",
                       "mn_gain"   = "Mean\ngain ",
                       "tl_kcal"   = "Total\nKCal",
                       "mn_kcal"   = "Mean\nKCal",
                       "tl_ksteps" = "Total   \nKSteps",
                       "mn_ksteps" = "Mean\nKSteps" ) %>% 
    align( j=1:13, align="left", part="header" ) %>% 
    bold( i=last_row, bold=TRUE, part="body" ) %>% 
    theme_zebra() %>% 
    fontsize( size = 14, part = "all") %>% 
    autofit()
#

```

#### ***End of report***