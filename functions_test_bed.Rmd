---
title: "Test bed for new functions"
author: "Craig W. Slinkman"
date: "4/13/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This is the test bed for the new functions for the **MyWalks** project.  

I have decided to define all my functions on a single source file to make development and
maintenance simpler.

### load packages

In the following chunk we load the required library functions for this project.

```{r load_packages}

###########################################################################
# Load required R-packkages ...
###########################################################################

 source('~/R-Projects/MyWalks/functions/load_packages.R')


###########################################################################
# load our defined functions ...
##########################################################################

source('~/R-Projects/MyWalks/functions/get_day_routes.R') 
source('~/R-Projects/MyWalks/functions/find_max_frequency.R')
source('~/R-Projects/MyWalks/functions/plot_bar_chart.R')
source('~/R-Projects/MyWalks/functions/convert_hhmm_to_decimal.R')
source('~/R-Projects/MyWalks/functions/plot_distribution.R')
source('~/R-Projects/MyWalks/functions/plot_qq_norm.R')
source('~/R-Projects/MyWalks/functions/diagnose_linearity.R')
source('~/R-Projects/MyWalks/functions/diagnose_heteroskedasticity.R')
source('~/R-Projects/MyWalks/functions/compute_parametrics.R')

```


### Set cowplot to be  the  default theme
```{r set_owplot}
theme_set( theme_cowplot())
```



### get_days()  test

The **get_days()** function should return a tibble of my walking data saved on a Microsoft Excel spreadsheet called **days.xlsx**.  

```{r test_get_days}
day_routes <- get_day_routes() # Test get days ...
day_routes                     # Returna a tibble of the day_routes ...
```


### plot_bar_walks()

```{r test_plot_bar_walks}

walked <-                              # Extract walked from
    day_routes %>%                     # day_routes
        select( walked )

walked = ifelse( walked == 0,          # Convert walked codes from binary
                 "Did not walk",      # to character for bar chart ...
                 "Walked")

scale <- seq( from = 0,                # Create breaks and label scales ...
              to = 375, 
              by = 10 )
            
plot_bar_chart( walked,
                variable_name = "Walked?",
                plot_title = "Days walked and not walked",
                frequency_scale = scale )
                
```

### Hardware-Software_user error

In this section we determine all the error that lead to data loss.

```{r list errors}
failure_reason <- 
    day_routes %>%
     filter( walked == 1 & 
             gps_failure == 1 ) %>% 
    select( failure_reason )

scale <- seq( from = 0, to = 8, by = 2 )

plot_bar_chart( failure_reason,
                variable_name = "Failure reason",
                plot_title = "Reasons for data loss",
                bar_width = 0.25,
                fill_color = "red", 
                frequency_scale = scale )   
    
    
```


### plot_bar_missed_reasons() test

```{r test_bar_missied_reasons}

missed_reason <- 
    day_routes %>% 
        filter( walked == 0 ) %>% 
            pull( missed_reason )

    plot_bar_chart( missed_reason, 
                    "Reasons for missing g walk",
                    "Distribution of reasons for missing walk" )
 

    

```

### test_convert_hhmm to_decimal

We are going to covert from hh:mm to hh.dd.

```{r test_convert_hhmm to decimal }

###########################################################################
# Below we extract the start times and element observations when the start # time was not record in day_routes
##########################################################################

start_times <-                                 # Extract start times from 
    convert_hhmm_to_decimal( day_routes )      # routes ....
 
 start_times <- start_times[ start_times > 0 ] # Eliminate observations when
                                               # zero start_times ...
 plot_distribution( 
     start_times,
     "Walk started times",
     "Distribution of walks starting times times" )
 
```

###  Test weather conditions

In this code we draw a bar chart of the weather conditions for each day.

```{r draw_barchart_of_weather}

###########################################################################
# In thiis code chunk we draw a bar chart of the weather conditions.
###########################################################################


###########################################################################
# We tbulate the sky condition to find the weather condition that occurs
# most often.  This will be a flipped barchart with lots of categories.
# Therefore we not use the function and will code it here.
###########################################################################

###########################################################################
# Exctract the sky variable.
###########################################################################

variable <- 
    day_routes %>%                        
        filter( !is.na( sky )) %>% 
            arrange( desc( sky )) %>% 
                select( sky ) 
            
###########################################################################
# Form a tibble and  to pass to ggplot.
###########################################################################

df <- tibble( variable )

############################################################################ Determine maximum frequency to allow us to add snapce for numerical
# frequencies to the right of the bars.
###########################################################################

max_frequency <- find_max_frequency( df )

############################################################################ Build tibble and send to ggplot.
###########################################################################

plot_bar_chart( variable,
                "Weather conditions",
                "Distribution of weather conditions" ) +
    theme(axis.text.x = 
              element_text(angle = 45, 
                           vjust = 1,
                           hjust=1))


   
    

    
```

### Plot the distribution walk temperatures

```{r plot_walk_termperatures}

temps <- 
    day_routes  %>% 
    pull( temp )

plot_distribution( temps,
                "Walling temperatures (Fahrenheit)",
                "Walking Temperatures Distribution" )

```

### Plot the distribution of relative humidity

```{r plot_distribution_humidity}

###############################################################################
# Plot the histogram and density plot od the relrive humidity.
###############################################################################

rh <-                                 
    day_routes %>% 
        pull( rh )

plot_distribution( rh,
                   "Relative humidity",
                   "Relative Humidity Distribution")

```

### Draw scatter plot of relative humidity versus walk temperature

```{r draw_scatter_plot_of rh_versus_temp}

day_routes %>%
    filter( !is.na(temp) & 
            !is.na(rh) & 
                !is.na( conditions ))  %>% 
    rename( "Conditions" = "conditions" ) %>% 
        
    
        ggplot( aes( x = temp, y = rh, color = Conditions  )) +
            geom_point( size = 2 )
        
```
## Shoes walked in
We draw a bar plot of the shoes used.

```{r draw_bar_plot_shoes}

day_routes %>% 
    filter( walked == 1) %>% 
    
        ggplot( aes( x = shoes )) +
            geom_bar( color = "black",
                      fill  = "green",
                      width = 0.5 )

```




## Miles walked

```{r plot_distribution_of_miles }

miles <- 
    day_routes %>% 
     filter( walked == 1 ) %>%
     pull( miles )

plot_distribution( miles,
                   "Miles walked",
                   "Distribution of miles walked" ) 

plot_qq_norm( miles,
              variable_name = "miles walked",
               plot_title = "Miles normal qq plot of miles" )
              

```

## Distribution of steps (000's) walked 

```{r plot_distibutiin_of_ksteps}

variable <- 
   day_routes %>% 
        filter( walked == 1 ) %>% 
            pull( steps )

plot_distribution( variable,
                   variable_name = "Steps walked",
                   plot_title = "Distribution of steps walked" )

plot_qq_norm( variable,
              variable_name = "Thousand steps walked",
              plot_title = "Normal QQ plot of thousand steps walked")  
              

```

plot_qq_norm( variable,
              variable_name = "Thousand steps walked",
              plot_title = "Normal QQ plot of thousand steps walked")  
              
              
### Investigation of the relationship between $miles$ and $steps$  

We start with a scatterplot of the steps versus the miles walked.

```{r draw_scatterplot_steps_versus_miles}

walks <- 
    day_routes %>% 
        filter( walked == 1) %>% 
        filter( !is.na( miles )) %>% 
        filter( !is.na( steps )) %>% 
            select( date_time,
                    route,
                    miles,
                    steps )
    

walks

ggplot( walks,
        aes( x = miles,
             y = steps )) +
    geom_point( na.rm = TRUE )  +
    geom_smooth( method = "lm",
                 na.rm = TRUE,
                 se = FALSE ) +
    geom_smooth( mehtod = "loess",
                 color = "green",
                 se = FALSE )
    
```

```{r fit_slr_model}

slr <- lm( steps ~ miles,
           data = walks )
summary( slr )



```
 
## Diagnostic checks

This section performs graphical diagnostic checks.

### Graphical check for linearity

```{r define_assess_linearity}

###########################################################################
# The function called below draws a scaterplot of the residuals versus
# fitted values.  Its major purpose is to check the linearity assumption
# although it can be used to discover potential outliers and # heteroskedasticity. 
###########################################################################

diagnose_linearity( slr )

```

### Diagnosing heteroskedasticity

```{r diagnose_heteroskedasticity}

###########################################################################
# The function called below draws a scaterplot of the residuals versus
# fitted values.  Its major purpose is to check the linearity assumption
# although it can be used to discover potential outliers and # heteroskedasticity. 

```


              