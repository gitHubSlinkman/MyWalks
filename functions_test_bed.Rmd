---
title: "Test bed for new functions"
author: "Craig W. Slinkman"
date: "4/13/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This is the test bed for the new functions for the **MyWalks** project.  

I have decided to define all my functions on a single source file to make development and
maintenance simpler.

### load packages

In the following chunk we load the required library functions for this project.

```{r load_packages}

###############################################################################
# Load required R-packkages ...
###############################################################################

 source('~/R-Projects/MyWalks/functions/load_packages.R')


###############################################################################
# load our defined functions ...
###############################################################################

source('~/R-Projects/MyWalks/functions/get_day_routes.R')
source('~/R-Projects/MyWalks/functions/draw_barchart.R')
source('~/R-Projects/MyWalks/functions/compute_parametrics.R')

```


### get_days()  test

The **get_days()** function should return a tibble of my walking data saved on a Microsoft Excel spreadsheet called **days.xlsx**.  

```{r test_get_days}
day_routes <- get_day_routes() # Test get days ...
day_routes                     # Returna a tibble of the day_routes ...
```


### plot_bar_walks()

```{r test_plot_bar_walks}

walked <-
    day_routes %>% 
        pull( "walked" )

n <- sum( walked )

df <- 
    tibble( walked ) %>%
       mutate( walked  = ifelse( walked == 0, 
                                 "No", 
                                 "Yes" ))
           
df %>%
    ggplot( aes( x = variable )) + 
        geom_bar( binwidth = 0.5,
                  color = "yellow",
                  fill  = "Yellow" ) +
        stat_bin( aes( label=..count..),
                       vjust=-1, 
                       geom="text", 
                       position="identity" ) +
        expand_limits( y = n + 10 ) +
        xlab( "Walked?" ) +
        ylab( "Freqiency" )
        

```

### Hardware-Software_user error

In this section we determine all the error that lead to data loss.

```{r list errors}

frequincies = seq( from  = 0,                    # Define y-scales
                   to = 32, 
                   by = 2 )

days %>%
    filter( walked == 1 & 
            gps_failure == 1 ) %>% 
    select( id,
            date_time,
            walked,
            gps_failure,
            failure_reason ) %>% 
    ggplot( aes( x = failure_reason )) +
         geom_bar( width = 0.25,
                   color = "red",
                   fill= "red" ) +
         xlab( "Errors" ) +
         scale_y_continuous( "Errors", 
                              breaks = frequincies,
                              label  = frequincies ) +
         ggtitle( "Errors that reult in lost data")
```


### plot_bar_missed_reasons() test

```{r test_bar_missied_reasons}
plot_bar_missed_reasons( days )
```

### test_convert_hhmm to_decimal

We are going to covert from hh:mm to hh.dd.

```{r test_convert_hhmm to decimal }
date_times <- 
    days %>% 
        filter( walked == 1 ) %>% 
            pull( date_time )

date_times <- as.POSIXct( date_times )

start_times <- convert_hhmm_to_decimal( date_times )

start_times <- start_times[ start_times > 0 ]



tibble( start_times ) %>% 
    ggplot( aes( x = start_times, y=..count.. )) +
                
                geom_histogram( binwidth = 0.25,
                                color="black",
                                fill = "yellow" )+
    xlab( "Start time") +
    ylab( "Frequency" ) +
    ggtitle( "Start times " )

```

###  Test weather conditiona

In this code we draw a bat chart of the weather conditions for each day.

```{r draw_bar_weather}

days %>% 
    select( weather ) %>% 
    ggplot( aes( x = weather)) +
    geom_bar( width = 0.25,
              color="black",
              fill="blue") +
    xlab( "Weather conditions" ) +
    theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
    ylab( "Frequency" ) +
    ggtitle( "Weather condition on all days" )

```


### Compute totals, means, standard deviationa, coeffcient of varriation, skewness, and kurtosis

```{r compute_parametrics}

###############################################################################
# We compute the parametric statistics for the importnat variables.  These
# include the totals (where they nmake sense), the means, standard deviations,
# skewness and huetosis.
###############################################################################

parametrics <- compute_parametrics( days ) 
parametrics

integer_columns <- c( 2 )
decimal_columns_0 <- c( 4 )
decimal_columns_2 <- c( 3 )

parametrics %>%
    flextable() %>% 
        width( j = 1, 2.0 ) %>%
        width( j = 4, 1.5 ) %>% 
        colformat_int( j = integer_columns ) %>% 
        colformat_num( j = decimal_columns_0 ) %>% 
        colformat_num( j = decimal_columns_2 ) 
 



```


