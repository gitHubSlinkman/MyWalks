---
title: "Test bed for new functions"
author: "Craig W. Slinkman"
date: "4/13/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This is the test bed for the new functions for the **MyWalks** project.  

I have decided to define all my functions on a single source file to make development and
maintenance simpler.

### load packages

In the following chunk we load the required library functions for this project.

```{r load_packages}

###############################################################################
# Load required R-packkages ...
###############################################################################

 source('~/R-Projects/MyWalks/functions/load_packages.R')


###############################################################################
# load our defined functions ...
###############################################################################

source('~/R-Projects/MyWalks/functions/get_day_routes.R') 
source('~/R-Projects/MyWalks/functions/find_max_frequency.R')
source('~/R-Projects/MyWalks/functions/convert_hhmm_to_decimal.R')
source('~/R-Projects/MyWalks/functions/plot_distribution.R')
source('~/R-Projects/MyWalks/functions/plot_qq_norm.R')
source('~/R-Projects/MyWalks/functions/compute_parametrics.R')

```


### Set cowplot to be  the  default theme
```{r set_owplot}
theme_set( theme_cowplot())
```



### get_days()  test

The **get_days()** function should return a tibble of my walking data saved on a Microsoft Excel spreadsheet called **days.xlsx**.  

```{r test_get_days}
day_routes <- get_day_routes() # Test get days ...
day_routes                     # Returna a tibble of the day_routes ...
```


### plot_bar_walks()

```{r test_plot_bar_walks}

tbl <-
    day_routes %>% 
        select( walked ) 
            

n <- sum( tbl$walked )


tbl %>% 
    mutate( walked = ifelse( walked == 0,
                                     "No",
                                     "Yes" )) %>% 
    ggplot( aes(x = walked )) +
        geom_bar( width = 0.5,
                  color = "black",
                  fill  = "yellow" ) +
     geom_text(stat='count', aes(label=..count..), vjust=-1) +
        geom_text(stat='count', aes(label=..count..), vjust=-1) +
        xlab( "Walked?")+ 
        ylab( "Frequency" ) +
        ggtitle( "Walks not made and ,made" ) +
        theme_bw()
 
```

### Hardware-Software_user error

In this section we determine all the error that lead to data loss.

```{r list errors}

day_routes %>%
    filter( walked == 1 & 
            gps_failure == 1 ) %>% 
    select( id,
            date_time,
            walked,
            gps_failure,
            failure_reason ) %>% 
    
    ggplot( aes( x = failure_reason )) +
         geom_bar( width = 0.25,
                   color = "black",
                   fill= "red" ) +
         xlab( "Errors" ) +
         ylab( "Frequencies" ) +
         ggtitle( "Errors that reult in lost data" ) +
        theme_bw()
```


### plot_bar_missed_reasons() test

```{r test_bar_missied_reasons}

day_routes %>% 
    filter( walked == 0 ) %>% 
    select( missed_reason ) %>% 
    
    ggplot( aes( x = missed_reason )) +
        geom_bar( color = "black",
                  fill = "red",
                  na.rm = TRUE ) +
        xlab( "Missed reaon") +
        ylab( "Frequency" ) +
        ggtitle( "Reasons for missing walks") +
        coord_flip()

```

### test_convert_hhmm to_decimal

We are going to covert from hh:mm to hh.dd.

```{r test_convert_hhmm to decimal }

###############################################################################
# Below we extract the start times and element observations when the start time
# was not record in day_routes
###############################################################################

start_times <-                                 # Extract start times from 
    convert_hhmm_to_decimal( day_routes )      # routes ....
 
 start_times <- start_times[ start_times > 0 ] # Eliminate observations when
                                               # zero start_times ...
 plot_distribution( start_times,
                    "Walk started times",
                    "Walks started times" )
 
```

###  Test weather conditions

In this code we draw a bar chart of the weather conditions for each day.

```{r draw_barchart_of_weather}

###############################################################################
# In thiis code chunk we draw a bar chart of the weather conditions.
###############################################################################


###############################################################################
# We tbulate the sky condition to find the weather condition that occurs most
# often.
###############################################################################

tabulation <-                         # Tabulate the sky conditions ...
    day_routes %>%                    # from the day_routes
        group_by( sky ) %>%           # group by sky
            mutate( frequency = n() ) # and cont occurences ...   
    
frequencies <-                        # Get the frequences from the
    tabulation %>%                    # tabulation ...
        pull( frequency )

max_y = max( frequencies ) + 8        # Add rrom for frequency labels ...          


day_routes %>%                        # Draw bar chart of sky conditions                   
    ggplot( aes( x = sky )) +
        geom_bar( color="black",
                  fill = "blue" ) +
        geom_text( stat='count', 
                   aes(label=..count..), 
                   vjust=-1) +
        expand_limits( y = max_y ) +
    xlab( "Weatther" ) +
    ylab( "Frequency" )  +
    ggtitle( "Weather conditions") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
    
```

### Plot the distribyution walk temoeratures

```{r plot_walk_termperatures}

temps <- 
    day_routes  %>% 
    pull( temp )

plot_distribution( temps,
                "Walling tempatures (Fahrenheit)",
                "Walking Temperatures Distribution" )

```

### Plot the distribution of relative humidity

```{r plot_distribution_humidity}

###############################################################################
# Plot the histogram and density plot od the relrive humidity.
###############################################################################

rh <-                                 
    day_routes %>% 
        pull( rh )

plot_distribution( rh,
                   "Relative humidity",
                   "Relative Hunidity Distribution")

```

### Draw scatter plot of relative humidity versus walk temperature

```{r draw_scatter_plot_of rh_versus_temp}

day_routes %>%
    filter( !is.na(temp) & 
            !is.na(rh) & 
                !is.na( conditions ))  %>% 
    rename( "Conditions" = "conditions" ) %>% 
        
    
        ggplot( aes( x = temp, y = rh, color = Conditions  )) +
            geom_point( size = 2 )
        
```
## Shoes walked in
We draw a bar plot of the shoes used.

```{r draw_bar_plot_shoes}

day_routes %>% 
    filter( walked == 1) %>% 
    
        ggplot( aes( x = shoes )) +
            geom_bar( color = "black",
                      fill  = "green",
                      width = 0.5 )

```




## Miles walked

```{r plot_distribution_of_miles }

miles <- 
    day_routes %>% 
     filter( walked == 1 ) %>%
     pull( miles )

plot_distribution( miles,
                   "Miles walked",
                   "Distributionn of miles walked" ) 

plot_qq_norm( miles,
              variable_name = "miles walked",
               plot_title = "Miles normal qq plot of miles" )
              

```

    