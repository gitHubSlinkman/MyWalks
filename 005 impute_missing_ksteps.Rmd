---
title: "Impute_missing_ksteps"
author: "Craig W. Slinkman"
date: "1/5/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

The R-Markdown script is used to detect the observation in the walks.csv files and to impute the values of the missing values of ksteps using simple linear regression.

### Load packages

I live in the tidyverse set of packages.  I have written a script that can be found in
my project **Rsource** to load these packages.  We load them with the source statement. 

```{r load_libraries}
#
source('~/R-Projects/Rsource/load_packages_v003.R')   # Load my commonly used 
#                                                     # packages ...
#
```
 
## Load required functionality 
 
 I have also  have written a set of functions that I frequently use.  These are also stored in the **Rsource** package.  We load the functions that are needed with the source statements.
 
```{r load_required_functions}
#
source('~/R-Projects/Rsource/compute_dates_v003.R')        # To compute useful 
                                                           # dates ...
#
source('~/R-Projects/MyWalks/functions/get_walks_v004.R')  # To get walks data ...
#
source('~/R-Projects/Rsource/plot_distribution.R')         # To draw histigram and
                                                           # density diagram
#
source('~/R-Projects/Rsource/plot_qq_norm.R')              # To draw normal QQ plot
                                                           # of residuals ...
#
```
 
## Compute the partition date 

Because the performance improves over the time period we only uses the last 180 days pf walks.  To do this task latter we need the date that is 180 days ago.  We compute this below.

```{r compute_dates}
#
dates <- compute_dates()
#
```


## Read data 

We read the **walks.csv** and the **routes.csv** files and join then on route name.  This file contains every day since I started recording my walks.

```{r read_data}
#
file_path <- file.path( "data", "walks.csv")     # Creat path to walks file ...
walks     <- get_walks( file_path )
#
```

## Filter data

We only use the last180 days day because my performance improved over the years I ha been walking.  IN addition we removed and day that a walk was not taken.

```{r remove_days_with_no_walks}
#
walks <-                                              
    walks %>%                                          
        filter(  date > dates$date_180_days_ago ) %>% 
            filter( walked == 1)
```

## Identify observations with missing ksteps observations 

We are going to identify the observations weather **ksteps** variable is missing.  If ksteps is missing this variable will have a value of one else it will have a value of zero.

```{r tag_missing_ksteps}
#

#
walks <-                                  
    walks %>% 
        mutate(  missing = ifelse(is.na(ksteps),1,0))
```

## Splitting the data into **non_missing_ksteps** and **missing_ksteps**

```{r slit_missing}
#
non_missing_ksteps <- 
    walks %>% 
        filter( missing == 0 )
#
missing_ksteps <- 
    walks %>% 
        filter( missing == 1)
#
```

## For all non-missing **ksteps**  

In this section we will build and validate a simple linear regression model using $distance$ to predict $ksteps$.  We use the dataset non_missing_ksteps for this analysis. 

### Scatterplot of Thousands pf Steps versus Distance walked

```{r plot_ksteps_versus_miles}

scale_miles  <- seq( from=0, to=8, by = 1 )
scale_ksteps <- seq( from=0, to = 14, by = 2 )

non_missing_ksteps %>% 
    ggplot( aes( x=miles, y=ksteps)) +
        geom_point() +
        geom_smooth( method="lm",
                     color="black") +
        geom_smooth( color="red") +
        scale_x_continuous( name = "Miles walked",
                            breaks = scale_miles,
                            labels = scale_miles ) +
        scale_y_continuous( name = "Thousand steps",
                            breaks = scale_ksteps,
                            labels = scale_ksteps ) +
    ggtitle( "Scatter plot of ksteps versus miles")
                            
#
```


The line looks approximately linear because the slight upper word curvature does not go outside the standard fit.  We note that there might be outliers and influential observations and we will investigate during the process of model validation.

### Fitting the linear gregrssion model

```{r fita_model}
#
ls_fit <- lm( ksteps ~ miles, 
              data = non_missing_ksteps )
summary(ls_fit)
#
```
 
```{r get_regression_diagnostics}
#
library( broom )                                 # To augment fitted model with
#                                                # dianostice ...
#
ls_fit_diagnostics <- augment( ls_fit )          # Suppliment model statiostics with 
                                                 # additional  diagnostics ...
ls_fit_diagnostics 
```
 
### Plot studebtized residuakls versus predicted values 

We will use the linda package to plot our diagnostic plots.

```{r load_regression_diagnostic_plots}
#
library(lindia)
#
```

### Plot residuals versus fitted
```{r draw_residdual versus fitted plot}
#
gg_resfitted( ls_fit )
#
```


Whie there appear to be outliers in the middle of the plot of resiiduals versus fitted there is no evidence of non-linearity or non-constant variabce.

## Draw scale_llocation plot

```{r draw_scle_location_plot}
#
gg_scalelocation( ls_fit )
#
```

## Draw box plot of residuals 

```{r draw_histogran_of_ressiduals}
#
plot_distribution( ls_fit_diagnostics$.resid,
                   "Residuals",
                   "Residual Distribution")
#
```

## Draw QQ normal plot of residuals 

```{r draw_qq_plot}
#
plot_qq_norm( ls_fit_diagnostics$.resid,
              variable_name = "residuals",
              plot_title = "Residual normal QQ plot")
#
```





