---
title: "Walks Analysis: Categorical variables"
author: "by Craig W. Slinkman"
date: "July 23, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


```{r load_packages, echo=FALSE}
#
suppressMessages( library( tidyverse ))
suppressMessages( library( cowplot ) )
suppressMessages( library( lubridate ) )
suppressMessages( library( flextable ) )
suppressMessages( library( officer ) )
suppressMessages( library( cowplot ) )
#
```

```{r display_period, echo=FALSE}

format_date <-                                   # Function to format dates 
    function( unformated_date ){
        format( unformated_date, "%Y-%m%-%d" )
    } 
        
current_date <- as.Date( today())                # Get current date ...
partition_date <- current_date - 180             # Get partition date
```


### Walks categorical analysis of walks for the interval from `r format_date( partition_date ) ` to `r format_date( current_date )`


```{r get_walks}
#
source( "functions/get_walks_ver_02.R" )
#
walks <- get_walks()
#
```

```{r partition_walks_by_age}
#
old_walks <- 
    walks %>% 
        filter( date < partition_date )

younger_walks <- 
    walks %>% 
        filter( date >= partition_date )
#
```

```{r build partition_age_table}

Age <- c( "Older than 180 days",
          "Younger than or equal 180 days",
          "All days walks")

Frequency <- c( dim( old_walks )[1],
                dim( younger_walks )[1],
                dim(walks)[1] )

Percent <- round( 100 * Frequency / Frequency[3], 1 )

partition_by_age <- tibble( Age, Frequency, Percent)

```

### Partition all walks by age

We define walks older than 180 days are older walks and are not used in this analysis.  Walks less than or equal to 180 days old we define to be younger walks.

```{r display_partition_by_age}

partition_by_age %>% 
    regulartable() %>% 
    fontsize( size=14, part="all" ) %>% 
    colformat_num( col_keys="Percent",
                   digits = 1 )

```

### plot walks by older and younger walks 

```{r plot_age_partition}
#
n     <- Frequency[3]


ticks <- seq( from=0, to=ceiling( 1.25*n  ), by=20 )


ggplot( partition_by_age[1:2,],
        aes( x=Age, y=Frequency )) +
    geom_bar( stat="identity",
              width=0.30,
              color="black",
              fill="yellow" ) +
    scale_y_continuous( breaks=ticks, 
                        labels=ticks ) +
    theme_cowplot()
#
```

```{r tabilate_missed_reasons}
#
reasons <-
    younger_walks %>% 
        filter( walked == 0 ) %>% 
        select(  missed_reason )
#
```

### Tabulation of reasons for missing walks

```{r plot_missed_reasons }

ticks <- seq( from=0, to=32, by=2 )

ggplot( reasons,
        aes( x= fct_rev( reasons$missed_reason ))) +
    geom_bar( color="black",
              fill="yellow" ) +
    scale_y_continuous( breaks=ticks,
                        labels=ticks ) +
    xlab( "Reason for missed walk") +
    coord_flip() +
    theme_cowplot()

```

### Routes walked

This section of report gives all the routes walked during the last 180 days.  Not all
routes listed on this report are in use and will disappear as they age.

```{r plot_routes_waklked}
#

ticks <- seq( from=0, to=256, by=2 )

younger_walks <- 
    younger_walks %>% 
        filter( walked == 1)
    
    ggplot( younger_walks,
            aes( x=fct_rev( younger_walks$route ))) +
        geom_bar( color="black",
                  fill="yellow" ) +
        scale_y_continuous( breaks=ticks,
                            labels=ticks ) +
    xlab("Routes") +
    ylab("Frequency") +
    theme_cowplot() +
    coord_flip()
```


```{r plot_start_times}

ggplot2( younger_walks,
         aes( x=start_hour)) +
    geom_bar( color="yellow")

```



