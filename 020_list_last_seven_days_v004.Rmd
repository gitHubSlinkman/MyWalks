---
title: "Last seven day's activities"
author: "by Craig W. Slinkman"
date: "May 13, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


```{r load_libraries}
#
source('~/R-Projects/Rsource/load_packages_v003.R')
#
```

```{r load_functions}
#
source('~/R-Projects/Rsource/compute_dates_v004.R')   # To compute needed dates ...          

source( "functions/get_walks_v005.R" )                # To get walks and compute
                                                      # derived walk data ...

source( "functions/compute_totals_means_stds_v004.R") #  Computes totals, means,
#                                                     # and standard deviations
#
source('functions/compute_summary_statistics_v001.R') # Compute totals, means, and
                                                      # standard deviations ...
#
source('~/R-Projects/Rsource/capitalize_first_letter_v001.R')
```

```{r compute_dates}
dates <- compute_dates()
date_current   <- dates$date_000_days_ago          # Acess curent date ,..
date_partition <- dates$date_007_days_ago         # Access date 7 days ago ...
#
```

### Last seven days walk activity
#### For the period `r date_partition` through `r date_current`


```{r get_walks}
#
file_path <- file.path( "data",                    # Build file path ...
                        "days_180.rds" )
#
load( file_path )                                  # Load last 180 days od data ...
#
```

```{r list_last_007_days_walks,results='asis'}
#
last_007_days_walks <-                             # Keep only last 7 days of
    days_180 %>%
        filter( walked == 1 ) %>%               # Keep only days with walks ....
        filter( date >= date_partition + 1 ) %>%   # Keep only last week ...
        mutate( walks = walked ) %>%               # Add walks to report data ...
        select( id,                                # Keep these variables only ...
                date,
                wday,
                missed_reason,
                walks,
                route,
                miles,
                ksteps,
                hours,
                mph,
                pace,
                kcal ) %>% 
    arrange( desc( id ))                          # Sort data descending order by                                                        # date 
#
```

```{r compute_x_scales}
#
x_min <- floor( min( last_007_days_walks$miles ))
x_max <- ceiling( max( last_007_days_walks$miles ))
#
```
 



```{r plot_dotplot}
#
x_major <- seq( from=x_min, to=x_max, by=0.50 )
x_labels <- sprintf("%.2f",x_major)
#
ggplot( last_007_days_walks, 
        aes(x=miles,
            binwidth=0.25 )) +
    geom_dotplot( binwidth =0.25,
                  dotsize = 0.25 ) +
    scale_x_continuous( breaks=x_major, labels=x_labels ) +
    coord_cartesian(  ylim = c( 0, 7)) +
    xlab("Miles walked") +
    ylab( "Frequency") +
    ggtitle( "Miles walked during last 7 days") +
    theme_cowplot()
#
```

```{r compute_summary_statistics}
#
report <- compute_summary_statistics( last_007_days_walks)
#
```


```{r build_flextabl_report}
#
integers   <- 5                                  # Specify the integer columns ...
decimals_0 <- 12                                 # Specify decimal columns with zero
                                                 # decimals ...
decimals_2 <- 7:11                               # Specimal columns with two decimal
                                                 # places ...
#
headers <- names( report )                       # Get column names from report ...
headers <- 
    capitalize_all_first_letters( headers )      # Capitalize the first letter
names( report ) <- headers                       # Reset column names

rows <- dim( report )[1]                         # Determine report rows and
cols <- dim( report )[2]                         # columns ....

    report %>%                                   # Send report data to
        flextable() %>%                          #   flextable to  ...
            colformat_char( j=1:4,               #   character formater to ...
                            na_str="") %>% 
            colformat_int( j=5,                  #   integer formater to ...
                           na_str="" ) %>% 
            colformat_num( j= decimals_2,        #   decimal formater ...
                           big.mark=",",
                           digits=2,
                           na_str="" ) %>% 
            colformat_num( j=decimals_0,         #  zero decial places formatter
                           big.mark=",",         # decimal formatter  ...
                           digits=0,
                           na_str="") %>% 
           width( j=2, 12) %>%                   # specify column with ,,,
           align( j=2, align="left" ) %>%        # to set alignment ...
           bold( i=(rows -2):rows,               # to bold formater 
                 bold=TRUE ) %>% 
           fontsize( size=14, part="all" ) %>% 
        autofit()                                # to autofit
#
```

#### End of report