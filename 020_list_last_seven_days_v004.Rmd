---
title: "Last seven day's activities"
author: "by Craig W. Slinkman"
date: "May 13, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


```{r load_libraries}
#
source('~/R-Projects/Rsource/load_packages_v003.R')
#
```

```{r load_functions}
#
source('~/R-Projects/Rsource/compute_dates_v003.R')   # To compute needed dates ...          

source( "functions/get_walks_v004.R" )                # To get walks and compute
                                                      # derived walk data ...

source( "functions/compute_totals_means_stds_v004.R") #  Computes totals, means,
#                                                     # and standard deviations
#
source('functions/compute_summary_statistics_v001.R') # Compute totals, means, and
                                                      # standard devviations ...#
source('~/R-Projects/Rsource/capitalize_first_letter_v001.R')
```

```{r compute_dates}
dates <- compute_dates()
date_current   <- dates$date_000_days_ago          # Acess curent date ,..
date_partition <- dates$date_007_days_ago          # Access date 7 days ago ...
#
```

### Last seven days walk activity
#### For the period `r date_partition` through `r date_current`


```{r get_walks}
#
file_path <-
    file.path( getwd(), "data/walks.csv")

walks <- get_walks( file_path )
#
```

```{r list_last_007_days_walks,results='asis'}

#
character_partition_date <- as.character.Date( date_partition )


last_007_days_walks <-
    walks %>%
        filter( as.character.Date( date ) >  character_partition_date ) %>% 
        mutate( walks = walked ) %>% 
        select( id, 
                date,
                wday,
                missed_reason,
                walks,
                route,
                miles,
                ksteps,
                hours,
                mph,
                pace,
                kcal ) %>% 
    arrange( desc( id ))


```

```{r plot_dotplot}

x_major <- seq( from=1, to=7, by=0.25 )
x_labels <- sprintf("%.2f",x_major)

ggplot( last_007_days_walks, 
        aes(x=miles,
            binwidth=0.25 )) +
    geom_dotplot() +
    scale_x_continuous( breaks=x_major, labels=x_labels ) +
    coord_cartesian( ylim = c(0, 7 )) +
    xlab("Miles walked") +
    ylab( "Frequency") +
    ggtitle( "Miles walked during last 7 days") +
    theme_cowplot()
```

```{r compute_summary_statistics}
#
report <- compute_summary_statistics( last_007_days_walks)
#
```


```{r build_flextable}
#
integers   <- 5
decimals_0 <- 12
decimals_2 <- 7:11

headers <- names( report )
headers <- capitalize_all_first_letters( headers )
names( report ) <- headers

rows <- dim( report )[1]
cols <- dim( report )[2]

    report %>% 
        flextable %>%
            colformat_char( j=1:4,
                            na_str="") %>% 
            colformat_int( j=5,
                           na_str="" ) %>% 
            colformat_num( j= decimals_2,
                           big.mark=",",
                           digits=2,
                           na_str="" ) %>% 
            colformat_num( j=decimals_0,
                           big.mark=",",
                           digits=0,
                           na_str="") %>% 
           width( j=2, 12) %>% 
           align( j=2, align="left" ) %>% 
           bold( i=(rows -2):rows, 
                 bold=TRUE ) %>% 
        autofit()
#

```

#### End of report