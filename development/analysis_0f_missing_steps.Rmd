---
title: "Analysis_0f_missing_steps"
author: "by Craig Slinkman"
date: "10/13/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

The function of this report is to select a model that can be used for imputing the values of the missing steps.  The steps variable is not recorded automatically by my Garmin and if I forget to record after a walk I will not have it. 

I will use the six months data in this analysis.

```{r load_packages}
require( tidyverse)                 # I live in the tidyverse ...
require( GGally )                   # Needed for matrix scatter plots ...
require( MASS )                     # For robust regressions ....
require( broom )                    # Used to tidy lm output ...
require( cowplot )                  # Required for professional graphics ...
require( flextable )
```
  

```{r load_functions}
source('D:/R-Projects/MyWalks/functions/get_day_routes_v01.R')
source('D:/R-Projects/MyWalks/functions/filter_by_days_v01.R')
```

```{r}
theme_set( theme_cowplot())
```



```{r get_and_wrangle_data}
all_day_routes <- get_day_routes()      # Read data from Excel spreadsheet.
all_day_routes                          # Verify successful read.

last_180_day_routes <- 
    filter_by_days( all_day_routes,     # Use last six months data.
                    180 )

walks_taken <-                          # Only keep day_walks when a walk 
    last_180_day_routes %>%             # was taken.
        filter( walked == 1 )

walks_taken
```




## Variables to use in this analysis

In this section we create a matrix plot of all the variables that are likely to be correlated with the variable of $steps$.
```{r plt_matrix_scatter_plot}
################################################################################
# We select those variables that are likely to be highly correlated with
# steps.  We then draw a matrix scatter plot.
################################################################################

variables <- 
  walks_taken %>% 
    select( id )

ggscatmat( variables,
           columns = 3:6 )
```


## Determing all observations with missing steps data

```{r}
missing_steps <-
    variables %>% 
        filter( is.na(steps))  

missing_steps
```

## Cases with non-missing_steps

```{r }

non_missing_steps <- 
    variables %>% 
        filter( !is.na( steps ))
non_missing_steps

```
  
## Create matrix scatter plot using non_missing_values

```{r}
ggscatmat( variables,
           columns = 3:6 ) +
    theme_cowplot()
```

## Suggested functional form

$$steps = \beta_0 + \beta_1 miles + error$$

or

$$steps = \beta_0 + \beta_1 miles + \beta_2 +error$$

## Split data in to fitting and validation data steps

```{r}
set.seed( 11235 )

n <- dim( non_missing_steps )[1]
n_f <- round( 2/3 * n)
n_v <- n - n_f

fit <- 0
while( sum( fit) != n_f )fit <- rbinom( n, size = 1, prob = 2/3 )

non_missing_steps <- 
  bind_cols( fit, non_missing_steps )

vnames    <- names( non_missing_steps )
vnames[1] <- "fit"
names( non_missing_steps ) <- vnames

fitting_rows <- 
  non_missing_steps %>% 
    filter( fit == 1 )

validation_rows <- 
  non_missing_steps %>% 
    filter( fit == 0 )
```

## Fitting_models

```{r}
fitting_rows %>% 
  ggplot( aes( x = miles, y= steps )) +
    geom_point() +
    geom_smooth( method = "lm",
                 se = FALSE )

```  

## Fir potential models

### Least squares OLS regression

```{r}
ols <- lm( steps ~ miles, data = non_missing_steps )
glance( ols ) %>% 
  flextable()
tidy( ols ) %>% 
  flextable()


```


