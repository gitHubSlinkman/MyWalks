---
title: "Missing values imputation using linear regression."
author: "by Craig W. Slinkman"
date: "11/22/2019"
output: html_document
---

## My Walks Analysis
## Imputation of the missing values of $ksteps$ 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Load libraries 
I use a source file to load packages that I use frequently.  The source file is
located in my Rsource library.


```{r load packages}
#
source( 'functions/load_libraries_v003.R' )      # Load R packages ...
#
```

```{r load_functions}
#
source('~/R-Projects/Rsource/compute_dates_v004.R')    # Computes useful dates ...
source( 'functions/get_days_v006.R' )                  # Load function to read ...
                                                       # walks and compute derived
                                                       # variables ...
source('~/R-Projects/Rsource/plot_diagnostics_v001.R') # Plot diagnostics ...
#
source('~/R-Projects/Rsource/plot_diagnostics_v001.R') # To perform graphical
                                                       # diagnostic analysis ...
```

```{r compute_dates}
#
dates <- compute_dates()                               # Compute dates lilely to be
                                                       # used most often ...
#
```
              
### Analysis dates 

This analysis is based on date from **`r dates$date_180_days_ago`** through **`r dates$date_000_days_ago`**.

## Read data 

```{r read_data}
#
all_days <- get_days()                         # Get days ...
#
```

### Number of days in file.

There are `r dim( all_days )[1]` days recorded in the $walks.csv$ file. 

## Getting all walks less than 180 days old 

```{r filter_walk}
#
partition_date <- as.Date( dates$date_180_days_ago + 1 )


recent_days <-                                  # Get last 180 days walks ...
    all_days %>% 
        filter( date > partition_date ) 
                
```

There are `r dim(recent_days)[1]` days in the recent walks.  After 180 days this number should be 180 or 179 if a walk has not been taken on the last day.

## Remove days with no walks

```{r remove_no_walks}
#
no_walk_days <-                                      # Get days with no walks ...
    recent_days %>% 
        filter( walked == 0 )

walk_days <- 
    recent_days %>% 
        filter( walked == 1 )
#
```

## Remove any row where $miles$ is missing

```{r remove_missing_miles}
#
walk_days <-                              # Filter out days where 
    walk_days %>%                         # is missing 
        filter( !is.na(miles) )

```


## Determine days where $ksteps$ is missing 

Here we partition the recent_walks into two subsets.  Days where the variable $ksteps$ is missing and days where $ksteps$ is not missing.

```{r partion_by_missing_ksteps}

missing_ksteps <-                             # Make a tibble that contians rows
    walk_days %>%                             # where ksteps is missing
        filter( is.na(ksteps))

not_missing_ksteps <-                                   # Make a tibble that contians rows
    walk_days %>%                             # where ksteps is not missing ...
        filter( !is.na(ksteps))
#
```


### Scatterplot of $ksteps$ versus $miles$ using not_missing_ksteps

```{r draw_scatterplot( ksteps_miles)}
#
ggplot( not_missing_ksteps,
        aes( x=miles, y=ksteps, color=environment)) +
    geom_point() +
    geom_smooth( method="lm",
                 color="black" ) +
    geom_smooth( method="loess",
                 color="red ")
#
```

## Fit model  $OLS_1: ksteps ~ miles$


```{r fit_ols_ksteps_on_miles}
#
ols_1 <- lm( ksteps ~ miles, 
           data=not_missing_ksteps )
tidy( ols_1 ) %>% 
    flextable( ) %>% 
    colformat_num( j=2:4,
                   digits=3 ) %>% 
    colformat_num( j=5, 
                digits = 4 ) %>% 
    add_header_lines( values ="ksteps ~ miles", 
                         top = TRUE) %>% 
    merge_at( i = 1, j = NULL, part = "header") %>% 
    fontsize( size=14,
              part="all" )  %>% 
    fontsize( size = 14, part="all" ) %>% 
    theme_box() %>% 
    autofit()
#
glance_1 <- bind_cols( data.frame( ols = 1 ),
                       glance( ols_1 ))
#
```

### Diagnostic analysis

```{r perform_diagnostic_analysis}
#
plots <- diagPlot( ols_1 )
#
plots$rvfPlot
plots$qqPlot
plots$sclLocPlot
plots$cdPlot
plots$rvlevPlot
plots$cvlPlot

```

## Fit model ols_2: $ksteps = environment + miles$

```{r fit_ols_2}
#
ols_2 <- lm( ksteps ~ environment + miles,
             data = not_missing_ksteps )
#
tidy( ols_2 ) %>% 
    flextable( ) %>% 
    colformat_num( j=2:4,
                   digits=3 ) %>% 
    colformat_num( j=5, 
                digits = 4 ) %>% 
    add_header_lines( values ="ksteps ~ miles", 
                         top = TRUE) %>% 
    merge_at( i = 1, j = NULL, part = "header") %>% 
    fontsize( size=14,
              part="all" )  %>% 
    fontsize( size = 14, part="all" ) %>% 
    theme_box() %>% 
    autofit()
#

glance_2 <- bind_cols( data.frame( ols = 2 ),
                       glance( ols_2 ))
#
```

### Diangnostioc analysis

```{r diasagnose_ols_2}
#
plots <- diagPlot( ols_2 )
#
plots$rvfPlot
plots$qqPlot
plots$sclLocPlot
plots$cdPlot
plots$rvlevPlot
plots$cvlPlot
#
```

## Moldel 0ls_3: $ksteps = environment * Miles$

```{r fit_ols3}
#
ols_3 <- lm( ksteps ~ environment * miles,
             data = not_missing_ksteps )

tidy( ols_3 ) %>% 
   flextable( ) %>% 
    colformat_num( j=2:4,
                   digits=3 ) %>% 
    colformat_num( j=5, 
                digits = 4 ) %>% 
    add_header_lines( values ="ksteps ~ miles", 
                         top = TRUE) %>% 
    merge_at( i = 1, j = NULL, part = "header") %>% 
    fontsize( size=14,
              part="all" )  %>% 
    fontsize( size = 14, part="all" ) %>% 
    theme_box() %>% 
    autofit()

glance_3= bind_cols( data.frame( ols = 3 ),
                      glance( ols_3 ))
#
```

# Diagnostic plots

```{r diagnose_ols_3}
#
plots <- diagPlot( ols_3 )
#
plots$rvfPlot
plots$qqPlot
plots$sclLocPlot
plots$cdPlot
plots$rvlevPlot
plots$cvlPlot
#
```

## Model OLS_4: $ksteps = route * miles $

```{r fir_ols_4}
#
ols_4 <- lm( ksteps ~ route * miles,
             data = not_missing_ksteps)
tidy(ols_4) %>% 
    flextable( ) %>% 
    colformat_num( j=2:4,
                   digits=3 ) %>% 
    colformat_num( j=5, 
                digits = 4 ) %>% 
    add_header_lines( values ="ksteps ~ miles", 
                         top = TRUE) %>% 
    merge_at( i = 1, j = NULL, part = "header") %>% 
    fontsize( size=14,
              part="all" )  %>% 
    fontsize( size = 14, part="all" ) %>% 
    theme_box() %>% 
    autofit()
#
glance_4= bind_cols( data.frame( ols = 4 ),
                      glance( ols_4 ))

```

### Disagnostic plots

```{r diagnose_ols_4}

plots <- diagPlot( ols_4 )
#
plots$rvfPlot
plots$qqPlot
plots$sclLocPlot
plots$cdPlot
plots$rvlevPlot
plots$cvlPlot
#


```

## Compare models

```{r compare_models}
models = bind_rows( glance_1,
                    glance_2,
                    glance_3,
                    glance_4 )
models %>% 
    flextable() %>% 
    colformat_num( j= 2:5,  digits = 2 ) %>% 
    colformat_num( j = 6,   digits = 4 ) %>% 
    colformat_num( j= 8:11, digits = 2 )

```
 ### Save imputation model
 
```{r save_imputation_model}

mviksteps <- ols_2 


```
 

